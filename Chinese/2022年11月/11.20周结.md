# 11月20日周结

## 回顾

- [x] 完成多邻国第 26 部分的学习；
- [x] 完成电商商品部分的学习。

## 现存问题

自从工作以来，发现干什么都不尽兴，没有正反馈。

本来以为这周可以把项目上线，下周就可以不用这么晚回家了，但是到现在售后的接口都调不通，确实很搞人心态。

现在学习的动力也不足，原因有两个：

1. 精力不足，每天下班很晚，回到家基本上就没什么精力了；
2. 没有正反馈，自己要学的东西太多，而且不知道什么时候能用上。现在精力有限，就不得不把时间花在刀刃上，很容易顾此失彼。一方面对业务场景不熟，另一方面基础也不扎实，有的根本就没接触过。

不过学了总比没学要强，学了差不过一个月的 mysql，这周才算用起来了。 起因是在获取视频号的订单列表时，如果订单存在则更新，否则就新增。

问题就出在更新上。

存储订单需要两张表，一张是订单表，一张是订单详情表。因为一个订单中会有多个商品，所以需要一张订单详情表来存储订单的商品信息。

订单表的更新很容易，因为订单编号是唯一的，所以用订单编号就很容易完成订单信息的更新，但是我却不知道该如何更新订单详情表。

订单表
|id|order_sn|...|
|----|----|---|
|1|O202211202119670123|...|

订单详情表
|id|order_id|product_sku|quantity|
|----|:----:|:----:|----|
|1|1|157890|2|
|2|1|157891|1|
|3|2|157890|3|

为啥会不知道该如何更新呢？因为一开始我以为我找不到唯一标识来更新记录。

- 如果只用 order_id 来更新记录，就会导致 order_id 相同的所有数据都相同。例如，以 order_id = 1 作为更新条件，那么 id = 1 和 id = 2 的两条记录各个字段的值都会相同；
- 如果只用 product_sku 来更新记录，就会出现和用 order_id 来更新记录类似的问题：相同 product_sku 的记录各个字段的值都一样。（因为订单 A 和订单 B 中可能会有同一个商品 A）

自己无法解决这个问题，便把问题反馈给小组长。小组长看完我写的“shi山”代码后，一步步引导我找到了更新条件，并且指出了我写的代码中存在的问题。

在平面上：

- 两点确定一条直线；
- 一个点的坐标由 x 轴和 y 轴的值来确定。

同理，一个条件无法准确地定位到某条记录时，再加一个条件便是，如果还是无法确定，那就再加条件，直到能够确定为止。

所以更新条件便是 order_id 和 product_sku，用 order_id 来确定是哪个订单，用 product_sku 来确定是哪个 sku，在这两个条件的作用下，就能准确地找到是哪条记录了。

更新条件找到了，不知道怎么更新订单详情表的问题自然就解决了。

潜在问题：

- 代码啰嗦，不够简洁明了；
- 关联新增时，没有使用事物，如果在关联添加数据时，一个表的数据添加成功，但是其他表却添加失败，就会造成数据的不完整，后期维护起来非常麻烦；

涉及到事物，就涉及到存储引擎：

- InnoDB：支持事物；
- MyISAM：不支持事物。

自己搭建的开发环境中，mysql 的版本是 5.7.3 创建表时默认的存储引擎是 MyISAM，而 MyISAM 存储引擎是不支持事物的，需要手动修改为 InnoDB；

```mysql
-- 修改存储引擎的语句：
ALTER TABLE <表名> ENGINE=<存储引擎名>;
-- 查看存储引擎的语句：
SHOW CREATE TABLE tab_name
```

经验教训

- 多看文档，边看边试，能用文档提供的方法就用文档提供的方法；
- 多条件更新；
- 关联新增、删除时，需要使用事物。

## 其他

- 本周五参加了公司的第三期乐跑；
- 周六和老芳和小亮打篮球，下午就又是打牌，老是输，不行，一定要想办法赢几次。

## 下周任务

- [ ] 多邻国第 27 部分的学习；
- [ ] mysql 的学习（看视频，能学多少个视频算多少个视频，但是最少 7 个，每天至少要一个吧，看看能不能养成习惯）；
- [ ] 电商其他业务场景的学习。